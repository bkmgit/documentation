---
description: >-
  In OpenCRVS v1.5.0 we have refactored the "workflow" microservice and
  deprecated the backend dependency on OpenHIM.  This has vastly improved the
  performance of the platform.
---

# v1.5.0: Release notes

### Breaking changes

*   **Removed dependency on OpenHIM.**&#x20;

    The performance of OpenHIM added an unexpected burden of 200 m/s to every interaction. Cumulatively, this was negatively affecting user experience and therefore we decided to deprecate it.&#x20;

    &#x20;Interested implementers are free to re-introduce OpenHIM should they wish to use it as an interoperability layer without affecting the performance of OpenCRVS now that our architecture no longer depends on it.

    The OpenHIM database is kept for backwards compatibility reasons and will be removed in v1.6. [OpenHIM](https://openhim.org/) is an Open Source middleware component designed for managing FHIR interoperability between disparate systems as part of the OpenHIE architectural specification.  We had been using this component in a much more fundamental way to monitor microservice comms in a similar fashion to Amazon SQS. &#x20;
*   **Upgrade node version to 18**

    This version enforces environment to have Node 18 installed (supported until April 2025) and removes support for Node 16

    * Use nvm to upgrade your local development environment to use node version `18.19.x.`
    * Specified operating systems in js modules as `darwin, linux`
    * Dev scripts and Vite run with an environment variable `NODE_OPTIONS=--dns-result-order=ipv4first` to resolve ipv4 addresses for `localhost` to support systems that resolves ipv6 addresses by default in Node versions >=17
*   **Update the certificate preview mechanism**

    In effort of minimizing JavaScript-bundle size, we have streamlined the way how review certificate -page renders certificates. In case the images in your certificates are previewing blurry, you need to update your SVG-certificates to print QR-codes and other images directly with `<image width="36" height="36" xlink:href="{{qrCode}}" x="500" y="770"></image>` instead of the more complicated `<rect fill="url(#pattern)"></rect>` -paradigm. This doesn't affect printed certificates as they are still created as previously.
*   **Generate default address according to logged-in user's location**

    We have dropped support for the 'agentDefault'  prop which was used as initial value for SELECT\_WITH\_DYNAMIC\_OPTIONS fields. If you have not made any changes to address generation, then this should not affect you.  If you have, you can refer to this PR to see how agentDefault has been deprecated in an example country: [https://github.com/opencrvs/opencrvs-farajaland/pull/978](https://github.com/opencrvs/opencrvs-farajaland/pull/978)
*   **Remove system admin UI items: Application, Certificates, User roles, Informant notifications**

    We have now moved to configuring these items away from the UI in favour of directly editing these from country configuration repository in code - specifically in application-config-default.ts.
* In infrastructure Github workflows: `SSH_PORT` is a new and required, Github Action environment variable which must be added.
* In infrastructure Github workflows: `SSH_HOST` should be moved from being a Github Action environment secret to a Github Action environment variable before it is deprecated in 1.7.0
*   **Treat backup host identically to other hosts. To migrate:**

    1. Move all inventory files (qa.yml, production.yml...) from `infrastructure/server-setup` to `infrastructure/server-setup/inventory`
    2. Run environment creator for your backup server `yarn environment:init --environment=backup`
    3. Reprovision all servers.


* Metabase default credentials now must be configured via countryconfig repository environment variables and secrets otherwise the dashboard service won't start
* For Metabase configuration, we renamed `farajaland-map.geojson` to `map.geojson` to not tie implementations into example country naming conventions.
* Removed `splitView` option from DOCUMENT\_UPLOADER\_WITH\_OPTION field.

### New features

* Introduced rate limiting to routes that could potentially be bruteforced or extracted PII from.
* The login and client application loading experience has improved. A loading bar appears before the javaScript bundle has loaded and this transitions when fetching records.&#x20;
* Development time logs are now much tidier and errors easier to point out. Production logging will still remain as is.&#x20;
* Masked emails and phone numbers from notification logs.
* Support for landscape certificate templates.
* Allow defining maxLength attribute for number type fields.
* A new certificate handlebar for registration fees has been added `registrationFees`
* A new certificate handlebar for logged-in user details has been added `loggedInUser`&#x20;
* Add support for image compression configuration. Two new properties to this form field are available: `DOCUMENT_UPLOADER_WITH_OPTION`
  * `compressImagesToSizeMB` : An optional prop of number type to define a compressed size. Compression is ignored when the input file is already smaller or equal of the given value or a falsy given value.
  * `maxSizeMB`: An optional validation prop to prevent input of a file bigger than a defined value.
* If a country doesnt wish to use Sentry for logging errors, the SENTRY\_DSN variable is now optional and the LogRocket option has been deprecated due to lack of demand.
* Given that upon an upgrade between versions of OpenCRVS, that users cache is cleared, it is important to inform staff to submit any draft applications before the upgrade date.  We introduced an "Email all users" feature so that National System Admins can send all staff messages.  This feature can be used for any other all staff comms that are deemed required.

<figure><img src="../../.gitbook/assets/Screenshot 2024-06-25 at 17.12.54.png" alt=""><figcaption></figcaption></figure>

* Upgrade Node.js to 18
* Included an endpoint for serving individual certificates in development mode.  This improves the developer experience when configuring certificates.
* Removed logrocket refrences.
* Enable gzip compression in client & login
* Use docker compose v2 in github workflows
* Added SMTP environment variables into the qa compose file to enable QA of SMTP servers.
* In the certificate, the 'Place of Certification' now accurately reflects the correct location.
* Groom's and Bride's name, printIssue translation variables updated [#124](https://github.com/opencrvs/opencrvs-countryconfig/pull/124)
* Add query mapper for International Postal Code field
* Add support for image compression configuration
* Provide env variables for metabase admin credentials
* Improved formatting of informant name for inProgress declaration emails
* Removed `splitView` option from DOCUMENT\_UPLOADER\_WITH\_OPTION field [#114](https://github.com/opencrvs/opencrvs-countryconfig/pull/114)

**Infrastructure improvements**

More improvements have been made to the infrastructure provisioning and Github environment creation scripts and documentation.  The complexity is somewhat reduced.

* We removed the example Wireguard VPN set up as it was confusing.  Our intention was to ensure that all implementers were aware that OpenCRVS should be installed behind a VPN and used Wireguard as an example.  But the configuration requirements for Wireguard confused implementers who are not using it.  Therefore we decided to remove Wireguard as an example. &#x20;
* We now have a "backup" environment and the backup server is automatically provisioned.  We moved the inventory file location to an explicit directory and removed parameters to scripts that can be automated. To migrate, move all inventory files (qa.yml, production.yml...) from `infrastructure/server-setup` to `infrastructure/server-setup/inventory` and reprovision all servers.
* Allow using staging to both periodically restore a production backup and also give it the capability if required to backup it's own data to a different location using `backup_server_remote_target_directory` and `backup_server_remote_source_directory` Ansible variables. This use case is mostly meant for OpenCRVS team internal use.
* We now automate SSH key exchange between application and backup server. For staging servers, automatically fetch production backup encryption key if periodic restore is enabled.  Therefore documentation is simplified for a new server set-up.
* Improved support for non-22 SSH port.

**Bug fixes**

* Handle back button click after issuing a declaration [#6424](https://github.com/opencrvs/opencrvs-core/issues/6424)
* Fix certificate verification QR code for a death declaration [#6230](https://github.com/opencrvs/opencrvs-core/issues/6230#issuecomment-1996766125)
* Fix certificate verification QR code crashing when gender is unknown [#6422](https://github.com/opencrvs/opencrvs-core/issues/6422)
* Fix certificate verification page missing registration center and the name of registrar [#6614](https://github.com/opencrvs/opencrvs-core/issues/6614)
* Amend certificate verification showing the certifying date instead of records creation date [#7098](https://github.com/opencrvs/opencrvs-core/pull/7098)
* Fix records not getting issued \[#6216] (https://github.com/opencrvs/opencrvs-core/issues/6216)
* Fix record correction e2e failing due to stale data getting saved on redux
* Convert eventDates to LocalDate before formatting [#6719](https://github.com/opencrvs/opencrvs-core/issues/6719)
* In advance search, any status tag is showing archived after search [#6678](https://github.com/opencrvs/opencrvs-core/issues/6678)
* Fix first name issues when creating a user [#6631](https://github.com/opencrvs/opencrvs-core/issues/6631)
* Show correct record option in certificate preview page when trying to print by RA [#6224](https://github.com/opencrvs/opencrvs-core/issues/6224)
* Fix certificate templates not getting populated for health facility event locations & ADMIN\_LEVEL > 2
* Fix download failure for incomplete (without date of death) death declarations [#6807](https://github.com/opencrvs/opencrvs-core/issues/6807)
* Fix search result declaration record audit unassign issue [#5781](https://github.com/opencrvs/opencrvs-core/issues/5781)
* In review page, Eliminating the 'No supporting documents' and 'upload' prompts when documents are already uploaded [#6231](https://github.com/opencrvs/opencrvs-core/issues/6231)
* In record audit page, after 'Correction request approved' the “record corrected” action is removed from history [#6228](https://github.com/opencrvs/opencrvs-core/issues/6228)
* Fix Registrar of any location should be able to review a correction request [#6247](https://github.com/opencrvs/opencrvs-core/issues/6247)
* remove upload button when no supporting docs are configured [#5944](https://github.com/opencrvs/opencrvs-core/issues/5944)
* Fix issues of invisible inputs when navigating from can't login link in login page [#6163](https://github.com/opencrvs/opencrvs-core/issues/6163)
* Fix the "Continue" button being disabled when changes in correction form is made [#6780](https://github.com/opencrvs/opencrvs-core/issues/6780)
* Remove leading slash from `resendAuthenticationCode` in login to fix resend email button [#6987](https://github.com/opencrvs/opencrvs-core/issues/6987) [#7037](https://github.com/opencrvs/opencrvs-core/issues/7037)
* Fix 'Place of Certification' is showing wrong in certificate \[#7060] (https://github.com/opencrvs/opencrvs-core/issues/7060)
* Fix dashboard cron jobs not working [#7016](https://github.com/opencrvs/opencrvs-core/issues/7016)
* Fix Check for valid date to handle incomplete marriage declarations [#7017](https://github.com/opencrvs/opencrvs-core/issues/7017)
* Fix session expiration when user tries to change phone number [#7003](https://github.com/opencrvs/opencrvs-core/pull/7025)
* Fix French translation missing for relationship to informant when trying to correct record, print and issue record \[#6341] (https://github.com/opencrvs/opencrvs-core/issues/6341)
* Fix client modal glitches on integrations page [#7002](https://github.com/opencrvs/opencrvs-core/issues/7002)
* Fix print record page for an unsaved declaration [#6893](https://github.com/opencrvs/opencrvs-core/issues/6893)
* Fix Reset pagination to default page (1) when location changes in UserList [#6481](https://github.com/opencrvs/opencrvs-core/issues/6481)
* Fix Disabling 'Mark as duplicate' button when duplicate reason is empty too [#7083](https://github.com/opencrvs/opencrvs-core/pull/7083)
* Fix certificate overflowing in preview certificate view [#7157](https://github.com/opencrvs/opencrvs-core/pull/7157)
* Fix records going completely missing when an unexpected error happens in the backend [#7021](https://github.com/opencrvs/opencrvs-core/pull/7021)
* Fix correction done from a certificate preview page [#7065](https://github.com/opencrvs/opencrvs-core/pull/7093)
* Fix "Print and issue to groom|bride" is added to a different variable [#7046](https://github.com/opencrvs/opencrvs-core/issues/7046)
* Fix search query is not being saved in the advanced search results [#7110](https://github.com/opencrvs/opencrvs-core/pull/7117)
* Fix removed duplicateTrackingId check in createDuplicateTask method [#7024](https://github.com/opencrvs/opencrvs-core/issues/7024)
* Fix address property handling and corrected country data transformation logic [#6989](https://github.com/opencrvs/opencrvs-core/issues/6989)
* Fix search indexing BRN's in place of identifiers. Adds spouseIdentifier to search with [#7189](https://github.com/opencrvs/opencrvs-core/pull/7189)
* Rename `farajaland-map.geojson` in dashboards to `map.geojson` to not tie opencrvs-core into a specific country implementation name [#7251](https://github.com/opencrvs/opencrvs-core/pull/7251)
* Fix unassign action not appearing in audit history [#7035](https://github.com/opencrvs/opencrvs-core/pull/7072)
* Update advanced search list properly when assignments change [#7307](https://github.com/opencrvs/opencrvs-core/pull/7307)
* Update Content-Security-Policy to allow loading fonts from country configuration [#7296](https://github.com/opencrvs/opencrvs-core/pull/7296)
* Fix frontend crashing on 'Registration by Status' under performance due to missing translations [#7129](https://github.com/opencrvs/opencrvs-core/pull/7129)
* Fix email of practitioner to be saved in hearth. A migration is added to correct the email of practitoiner in existing db. [7315](https://github.com/opencrvs/opencrvs-core/pull/7315)
